import{c as T,h as k,e as Z,d as G}from"./render.3e43a2fa.js";import{c as v,h as g,r as w,V as A,o as q,t as O,n as M,q as j,g as L,U as V,k as K,m as $,w as S,v as F,W as Y,X as ee,Y as P,Z as te,x as ne,_ as oe,y as ae,N as ie,E as re,$ as le}from"./index.0f416437.js";import{g as se,a as ue,b as ce,c as D}from"./scroll.cd16a84c.js";var we=T({name:"QToolbarTitle",props:{shrink:Boolean},setup(e,{slots:d}){const o=v(()=>"q-toolbar__title ellipsis"+(e.shrink===!0?" col-shrink":""));return()=>g("div",{class:o.value},k(d.default))}}),ze=T({name:"QToolbar",props:{inset:Boolean},setup(e,{slots:d}){const o=v(()=>"q-toolbar row no-wrap items-center"+(e.inset===!0?" q-toolbar--inset":""));return()=>g("div",{class:o.value,role:"toolbar"},k(d.default))}});function de(){const e=w(!A.value);return e.value===!1&&q(()=>{e.value=!0}),e}const J=typeof ResizeObserver!="undefined",I=J===!0?{}:{style:"display:block;position:absolute;top:0;left:0;right:0;bottom:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:-1;",url:"about:blank"};var B=T({name:"QResizeObserver",props:{debounce:{type:[String,Number],default:100}},emits:["resize"],setup(e,{emit:d}){let o=null,t,n={width:-1,height:-1};function l(s){s===!0||e.debounce===0||e.debounce==="0"?u():o===null&&(o=setTimeout(u,e.debounce))}function u(){if(clearTimeout(o),o=null,t){const{offsetWidth:s,offsetHeight:i}=t;(s!==n.width||i!==n.height)&&(n={width:s,height:i},d("resize",n))}}const{proxy:f}=L();if(J===!0){let s;const i=m=>{t=f.$el.parentNode,t?(s=new ResizeObserver(l),s.observe(t),u()):m!==!0&&j(()=>{i(!0)})};return q(()=>{i()}),O(()=>{clearTimeout(o),s!==void 0&&(s.disconnect!==void 0?s.disconnect():t&&s.unobserve(t))}),M}else{let m=function(){clearTimeout(o),i!==void 0&&(i.removeEventListener!==void 0&&i.removeEventListener("resize",l,V.passive),i=void 0)},p=function(){m(),t&&t.contentDocument&&(i=t.contentDocument.defaultView,i.addEventListener("resize",l,V.passive),u())};const s=de();let i;return q(()=>{j(()=>{t=f.$el,t&&p()})}),O(m),f.trigger=l,()=>{if(s.value===!0)return g("object",{style:I.style,tabindex:-1,type:"text/html",data:I.url,"aria-hidden":"true",onLoad:p})}}}}),xe=T({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(e,{slots:d,emit:o}){const{proxy:{$q:t}}=L(),n=K(F,$);if(n===$)return console.error("QHeader needs to be child of QLayout"),$;const l=w(parseInt(e.heightHint,10)),u=w(!0),f=v(()=>e.reveal===!0||n.view.value.indexOf("H")>-1||t.platform.is.ios&&n.isContainer.value===!0),s=v(()=>{if(e.modelValue!==!0)return 0;if(f.value===!0)return u.value===!0?l.value:0;const a=l.value-n.scroll.value.position;return a>0?a:0}),i=v(()=>e.modelValue!==!0||f.value===!0&&u.value!==!0),m=v(()=>e.modelValue===!0&&i.value===!0&&e.reveal===!0),p=v(()=>"q-header q-layout__section--marginal "+(f.value===!0?"fixed":"absolute")+"-top"+(e.bordered===!0?" q-header--bordered":"")+(i.value===!0?" q-header--hidden":"")+(e.modelValue!==!0?" q-layout--prevent-focus":"")),z=v(()=>{const a=n.rows.value.top,b={};return a[0]==="l"&&n.left.space===!0&&(b[t.lang.rtl===!0?"right":"left"]=`${n.left.size}px`),a[2]==="r"&&n.right.space===!0&&(b[t.lang.rtl===!0?"left":"right"]=`${n.right.size}px`),b});function c(a,b){n.update("header",a,b)}function y(a,b){a.value!==b&&(a.value=b)}function Q({height:a}){y(l,a),c("size",a)}function E(a){m.value===!0&&y(u,!0),o("focusin",a)}S(()=>e.modelValue,a=>{c("space",a),y(u,!0),n.animate()}),S(s,a=>{c("offset",a)}),S(()=>e.reveal,a=>{a===!1&&y(u,e.modelValue)}),S(u,a=>{n.animate(),o("reveal",a)}),S(n.scroll,a=>{e.reveal===!0&&y(u,a.direction==="up"||a.position<=e.revealOffset||a.position-a.inflectionPoint<100)});const C={};return n.instances.header=C,e.modelValue===!0&&c("size",l.value),c("space",e.modelValue),c("offset",s.value),O(()=>{n.instances.header===C&&(n.instances.header=void 0,c("size",0),c("offset",0),c("space",!1))}),()=>{const a=Z(d.default,[]);return e.elevated===!0&&a.push(g("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),a.push(g(B,{debounce:0,onResize:Q})),g("header",{class:p.value,style:z.value,onFocusin:E},a)}}}),Se=T({name:"QPageContainer",setup(e,{slots:d}){const{proxy:{$q:o}}=L(),t=K(F,$);if(t===$)return console.error("QPageContainer needs to be child of QLayout"),$;Y(ee,!0);const n=v(()=>{const l={};return t.header.space===!0&&(l.paddingTop=`${t.header.size}px`),t.right.space===!0&&(l[`padding${o.lang.rtl===!0?"Left":"Right"}`]=`${t.right.size}px`),t.footer.space===!0&&(l.paddingBottom=`${t.footer.size}px`),t.left.space===!0&&(l[`padding${o.lang.rtl===!0?"Right":"Left"}`]=`${t.left.size}px`),l});return()=>g("div",{class:"q-page-container",style:n.value},k(d.default))}});const{passive:U}=V,fe=["both","horizontal","vertical"];var ve=T({name:"QScrollObserver",props:{axis:{type:String,validator:e=>fe.includes(e),default:"vertical"},debounce:[String,Number],scrollTarget:{default:void 0}},emits:["scroll"],setup(e,{emit:d}){const o={position:{top:0,left:0},direction:"down",directionChanged:!1,delta:{top:0,left:0},inflectionPoint:{top:0,left:0}};let t=null,n,l;S(()=>e.scrollTarget,()=>{s(),f()});function u(){t!==null&&t();const p=Math.max(0,ue(n)),z=ce(n),c={top:p-o.position.top,left:z-o.position.left};if(e.axis==="vertical"&&c.top===0||e.axis==="horizontal"&&c.left===0)return;const y=Math.abs(c.top)>=Math.abs(c.left)?c.top<0?"up":"down":c.left<0?"left":"right";o.position={top:p,left:z},o.directionChanged=o.direction!==y,o.delta=c,o.directionChanged===!0&&(o.direction=y,o.inflectionPoint=o.position),d("scroll",{...o})}function f(){n=se(l,e.scrollTarget),n.addEventListener("scroll",i,U),i(!0)}function s(){n!==void 0&&(n.removeEventListener("scroll",i,U),n=void 0)}function i(p){if(p===!0||e.debounce===0||e.debounce==="0")u();else if(t===null){const[z,c]=e.debounce?[setTimeout(u,e.debounce),clearTimeout]:[requestAnimationFrame(u),cancelAnimationFrame];t=()=>{c(z),t=null}}}const{proxy:m}=L();return q(()=>{l=m.$el.parentNode,f()}),O(()=>{t!==null&&t(),s()}),Object.assign(m,{trigger:i,getPosition:()=>o}),M}}),Te=T({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:e=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(e.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(e,{slots:d,emit:o}){const{proxy:{$q:t}}=L(),n=w(null),l=w(t.screen.height),u=w(e.container===!0?0:t.screen.width),f=w({position:0,direction:"down",inflectionPoint:0}),s=w(0),i=w(A.value===!0?0:D()),m=v(()=>"q-layout q-layout--"+(e.container===!0?"containerized":"standard")),p=v(()=>e.container===!1?{minHeight:t.screen.height+"px"}:null),z=v(()=>i.value!==0?{[t.lang.rtl===!0?"left":"right"]:`${i.value}px`}:null),c=v(()=>i.value!==0?{[t.lang.rtl===!0?"right":"left"]:0,[t.lang.rtl===!0?"left":"right"]:`-${i.value}px`,width:`calc(100% + ${i.value}px)`}:null);function y(r){if(e.container===!0||document.qScrollPrevented!==!0){const h={position:r.position.top,direction:r.direction,directionChanged:r.directionChanged,inflectionPoint:r.inflectionPoint.top,delta:r.delta.top};f.value=h,e.onScroll!==void 0&&o("scroll",h)}}function Q(r){const{height:h,width:x}=r;let H=!1;l.value!==h&&(H=!0,l.value=h,e.onScrollHeight!==void 0&&o("scroll-height",h),C()),u.value!==x&&(H=!0,u.value=x),H===!0&&e.onResize!==void 0&&o("resize",r)}function E({height:r}){s.value!==r&&(s.value=r,C())}function C(){if(e.container===!0){const r=l.value>s.value?D():0;i.value!==r&&(i.value=r)}}let a;const b={instances:{},view:v(()=>e.view),isContainer:v(()=>e.container),rootRef:n,height:l,containerHeight:s,scrollbarWidth:i,totalWidth:v(()=>u.value+i.value),rows:v(()=>{const r=e.view.toLowerCase().split(" ");return{top:r[0].split(""),middle:r[1].split(""),bottom:r[2].split("")}}),header:P({size:0,offset:0,space:!1}),right:P({size:300,offset:0,space:!1}),footer:P({size:0,offset:0,space:!1}),left:P({size:300,offset:0,space:!1}),scroll:f,animate(){a!==void 0?clearTimeout(a):document.body.classList.add("q-body--layout-animate"),a=setTimeout(()=>{document.body.classList.remove("q-body--layout-animate"),a=void 0},155)},update(r,h,x){b[r][h]=x}};if(Y(F,b),D()>0){let x=function(){r=null,h.classList.remove("hide-scrollbar")},H=function(){if(r===null){if(h.scrollHeight>t.screen.height)return;h.classList.add("hide-scrollbar")}else clearTimeout(r);r=setTimeout(x,300)},_=function(N){r!==null&&N==="remove"&&(clearTimeout(r),x()),window[`${N}EventListener`]("resize",H)},r=null;const h=document.body;S(()=>e.container!==!0?"add":"remove",_),e.container!==!0&&_("add"),te(()=>{_("remove")})}return()=>{const r=G(d.default,[g(ve,{onScroll:y}),g(B,{onResize:Q})]),h=g("div",{class:m.value,style:p.value,ref:e.container===!0?void 0:n,tabindex:-1},r);return e.container===!0?g("div",{class:"q-layout-container overflow-hidden",ref:n},[g(B,{onResize:E}),g("div",{class:"absolute-full",style:z.value},[g("div",{class:"scroll",style:c.value},[h])])]):h}}});let W=new Date(0),R=null;function X(){const e="https://mappa-proxy.fly.dev";function d(){return new Promise(async t=>{if(R&&W>new Date-1e3*60*5){console.debug("getHC: cached data",R),t(R.status=="HEALTHY"?"OK":R.mappa_server.status);return}fetch(`${e}/hc`).then(n=>n.json()).then(n=>{W=new Date,R=n,console.debug("getHC: got data",n),t(n.status=="HEALTHY"?"OK":n.mappa_server.status)}).catch(()=>t("ERROR"))})}function o(t,n){return new Promise(async(l,u)=>{fetch(`${e}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:n})}).then(f=>f.json()).then(f=>{l(f)}).catch(()=>u("ERROR"))})}return{getHC:d,login:o}}const he=ne({name:"ProxyInfo",data(){return{proxyData:w("loading...")}},mounted(){X().getHC().then(e=>{this.proxyData=e})}});function ge(e,d,o,t,n,l){return ae(),ie("div",null,"Proxy "+re(e.proxyData),1)}var $e=oe(he,[["render",ge]]);const me=X(),Ce=le("auth",{state:()=>({auth:"",userId:0,validUntil:new Date}),getters:{isAuthenticated:e=>!!e.auth},actions:{async login(e,d){try{const o=await me.login(e,d);this.auth=o.auth,this.userId=o.userId,this.validUntil=new Date(o.created).getTime()+o.ttl*1e3}catch(o){console.error(o)}}}});export{$e as P,Te as Q,ze as a,we as b,xe as c,Se as d,Ce as u};
